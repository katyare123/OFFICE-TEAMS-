<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OFFICE TEAMS </title>
    <link rel="icon" href="https://th.bing.com/th/id/OIG3.U6mysBdKXx0y71.a.M1B?w=270&h=270&c=6&r=0&o=5&dpr=1.3&pid=ImgGn">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <style>
        /* General Reset */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* Body and General Styles */
body {
    font-family: 'Arial', sans-serif;
    color: #ddd;
    background: url('https://th.bing.com/th?id=OIP.Q1ppGz5JUcHQL5uTcXNgqgHaEK&w=333&h=187&c=8&rs=1&qlt=90&o=6&dpr=1.3&pid=3.1&rm=2') ;
    background-size: cover;
    padding: 20px;
    min-height: 100vh;
}

/* Header Styles */
header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: rgba(9, 255, 255, 0.8);
    padding: 10px 20px;
    border-radius: 8px;
    margin-bottom: 20px;
}

header h1 {
    color: #fff;
    font-size: 24px;
}

header button {
    background-color: #e74c3c;
    color: #fff;
    border: none;
    padding: 10px 20px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
    transition: background-color 0.3s;
}

header button:hover {
    background-color: #c0392b;
}

/* Authentication Section */
#auth {
    background-color: rgba(0, 0, 0, 0.8);
    padding: 20px;
    border-radius: 8px;
    width: 100%;
    max-width: 500px;
    margin: 0 auto;
    border: 2px solid white;
}

#auth h2 {
    color: #fff;
    font-size: 20px;
    margin-bottom: 20px;
}

.authButton {
    background-color: #3498db;
    color: #fff;
    border: none;
    padding: 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
    margin: 5px;
    transition: background-color 0.3s;
}

.authButton:hover {
    background-color: #2980b9;
}

#authForm input {
    width: calc(100% - 22px);
    padding: 10px;
    border: 1px solid #555;
    border-radius: 4px;
    margin-bottom: 10px;
    background-color: #333;
    color: #ddd;
}

#authForm button {
    background-color: #2ecc71;
    color: #fff;
    border: none;
    padding: 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
    transition: background-color 0.3s;
}

#authForm button:hover {
    background-color: #27ae60;
}

#authMessage {
    color: #e74c3c;
    font-size: 14px;
    margin-top: 10px;
}

/* Main Section */
#main {
    display: none;
}

/* Chat Section */
#chat {
    background-color: rgba(82, 76, 76, 0.8);
    padding: 20px;
    border-radius: 8px;
    width: 300px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    height: 80vh;
    border:2px solid #fff9f9;
    overflow: hidden;
}

#chatMessages {
    flex: 1;
    overflow-y: auto;
    padding-bottom: 10px;
    border:2px solid white;
}

#chatForm {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 10px;
}

#messageInput {
    padding: 10px;
    border: 1px solid #555;
    border-radius: 4px;
    background-color: #333;
    color: #ddd;
    font-size: 16px;
}

#sendButton {
    background-color: #2ecc71;
    color: #fff;
    border: none;
    padding: 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
    transition: background-color 0.3s;
}

#sendButton:hover {
    background-color: #27ae60;
}

#upload {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.file-upload-button {
    background-color: #3498db;
    color: #fff;
    border: none;
    padding: 10px;
    border-radius: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 5px;
    transition: background-color 0.3s;
}

.file-upload-button:hover {
    background-color: #2980b9;
}
/* Button Group */
.button-group {
    display: flex;
    gap: 10px;
}

.file-upload-button {
    background-color: #3498db;
    color: #fff;
    border: none;
    padding: 10px;
    border-radius: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 5px;
    transition: background-color 0.3s;
}

.file-upload-button:hover {
    background-color: #2980b9;
}

.fileInput {
    display: none;
}

#sendButton {
    background-color: #2ecc71;
    color: #fff;
    border: none;
    padding: 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
    transition: background-color 0.3s;
}

#sendButton:hover {
    background-color: #27ae60;
}

.fileInput {
    display: none;
}

/* Chat Message Styles */
.chat-message {
    background-color: #02775af8;
    padding: 10px;
    border-radius: 4px;
    margin-bottom: 10px;
    position: relative;
    border: 2px solid black;
    width:200px;
    height:fit-content;
   
}

.message-content {
    margin-bottom: 10px;
    font-size: 15px;
   
    

}

.message-content img {
    width: 175px;;
    border-radius: 4px;
    height: auto;

}

.message-timestamp {
    font-size: 12px;
    color: #fef9f9;
    text-align: right;

}

.message-date {
    font-size: 14px;
    color: #000000;
    text-align: center;
    margin-bottom: 10px;
    background-color: #ffffff;
    border: solid 2px rgb(0, 0, 0);
    width: 75px;
    display: flex;
    align-items: center;
   
}

/* Footer Styles */
footer {
    text-align: center;
    margin-top: 20px;
    color: #ffffff;
    background: #000000;
}

footer p {
    font-size: 14px;
}

       
    </style>
</head>
<body>
    <header>
        <h1>OFFICE TEAMS <i class="fa-solid fa-people-group"></i></h1>
        <button id="logoutButton">Logout <i class="fa-solid fa-arrow-right-from-bracket"></i></button>
    </header>
    <main>
        <section id="auth">
            <h2>OFFICE TEAMS LOGIN <i class="fa-solid fa-people-group"></i></h2>
            <div id="authMode">
                <button id="loginMode" class="authButton">Login</button>
                <button id="signupMode" class="authButton">Create Account</button>
            </div>
            <div class="login">
            <form id="authForm" >
                <input type="email" id="email" placeholder="Email" required>
                <input type="password" id="password" placeholder="Password" required>
                <input type="text" id="username" placeholder="Username (Required for Signup)" style="display: none;">
                <button type="submit" id="submitButton">Submit</button>
            </form>
            <p id="authMessage"></p>
        </section></div>
        <section id="main" style="display: none;">
           
            </nav>
           
            <section id="chat">
                <h2><i class="fa-regular fa-comment">Chat</i></h2>
                <div id="chatMessages"></div>
                <form id="chatForm">
                    <input type="text" id="messageInput" placeholder="Type your message here" required>
                    <div class="button-group">
                        <label for="fileInput" class="file-upload-button">
                            <input type="file" class="fileInput" id="fileInput">
                            <span><i class="fa-solid fa-cloud-arrow-up"></i></span>
                        </label> <button type="button" id="uploadButton">send image</button>
                        <button type="submit" id="sendButton"><i class="fa-solid fa-paper-plane"></i> Send</button>
                    </div>
                </form>
                
            </section>
            
        </section>
    </main>
    

    <!-- Firebase SDK -->
     <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.8.1/firebase-app.js';
import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp, doc, setDoc, getDoc, query, orderBy } from 'https://www.gstatic.com/firebasejs/9.8.1/firebase-firestore.js';
import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/9.8.1/firebase-storage.js';
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.8.1/firebase-auth.js';

const firebaseConfig = {
    apiKey: "AIzaSyBx4fy6AVoOcYF36pU4-NbnWTF9Et1qJwE",
    authDomain: "chat-21df0.firebaseapp.com",
    projectId: "chat-21df0",
    storageBucket: "chat-21df0.appspot.com",
    messagingSenderId: "434728817636",
    appId: "1:434728817636:web:6d8b6e0807953ad8eeedf1"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);
const auth = getAuth(app);

const authSection = document.getElementById('auth');
const mainSection = document.getElementById('main');
const logoutButton = document.getElementById('logoutButton');
const authForm = document.getElementById('authForm');
const usernameInput = document.getElementById('username');
const submitButton = document.getElementById('submitButton');
const chatMessages = document.getElementById('chatMessages');
const chatForm = document.getElementById('chatForm');
const messageInput = document.getElementById('messageInput');
const fileInput = document.getElementById('fileInput');
const uploadButton = document.getElementById('uploadButton');

let currentDate = '';

// Function to show authentication section
function showAuth() {
    authSection.style.display = 'block';
    mainSection.style.display = 'none';
}

// Function to show main content
function showMain() {
    authSection.style.display = 'none';
    mainSection.style.display = 'block';
}

// Function to switch to login mode
function showLoginMode() {
    usernameInput.style.display = 'none';
    submitButton.textContent = 'Login';
}

// Function to switch to signup mode
function showSignupMode() {
    usernameInput.style.display = 'block';
    submitButton.textContent = 'Create Account';
}

// Event listeners for authentication mode
document.getElementById('loginMode').addEventListener('click', showLoginMode);
document.getElementById('signupMode').addEventListener('click', showSignupMode);

// Monitor authentication state
onAuthStateChanged(auth, user => {
    if (user) {
        showMain();
        console.log('User is logged in:', user.email);
    } else {
        showAuth();
        console.log('No user logged in');
    }
});

// Authentication form submission
authForm.addEventListener('submit', async function(event) {
    event.preventDefault();
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const username = document.getElementById('username').value;

    try {
        if (submitButton.textContent === 'Create Account') {
            if (!username) throw new Error('Username is required for signup.');
            const userCredential = await createUserWithEmailAndPassword(auth, email, password);
            console.log('User registered:', userCredential.user);
            await setDoc(doc(db, 'users', userCredential.user.uid), { username: username });
            showMain();
        } else {
            const userCredential = await signInWithEmailAndPassword(auth, email, password);
            console.log('User signed in:', userCredential.user);
            showMain();
        }
    } catch (error) {
        document.getElementById('authMessage').textContent = error.message;
    }
});

// Logout button event listener
logoutButton.addEventListener('click', () => {
    signOut(auth).then(() => {
        showAuth();
    }).catch((error) => {
        console.error('Sign out error:', error);
    });
});

// Chat functionality
const chatCollection = collection(db, 'chats');

async function getUserName(uid) {
    try {
        const userDoc = await getDoc(doc(db, 'users', uid));
        return userDoc.exists() ? userDoc.data().username : 'Anonymous';
    } catch (error) {
        console.error('Error fetching user name:', error);
        return 'Anonymous';
    }
}

function formatTimestamp(timestamp) {
    const date = timestamp.toDate();
    return {
        date: date.toLocaleDateString(),
        time: date.toLocaleTimeString()
    };
}

// Function to send a message
async function sendMessage(message, imageUrl = '') {
    const user = auth.currentUser;
    const username = user ? await getUserName(user.uid) : 'Anonymous';
    return addDoc(chatCollection, {
        text: message,
        imageUrl: imageUrl,
        timestamp: serverTimestamp(),
        user: username
    });
}



// Load messages with oldest at the top and newest at the bottom
function loadMessages() {
    const q = query(chatCollection, orderBy('timestamp', 'asc')); // Fetch messages in ascending order
    onSnapshot(q, (snapshot) => {
        chatMessages.innerHTML = ''; // Clear existing messages

        snapshot.forEach(doc => {
            const message = doc.data();
            const { date, time } = formatTimestamp(message.timestamp);

            // Only add a new date section if the date has changed
            if (currentDate !== date) {
                const dateElement = document.createElement('div');
                dateElement.classList.add('message-date');
                dateElement.textContent = date;
                chatMessages.appendChild(dateElement);
                currentDate = date; // Update currentDate to the new date
            }

            // Create and append message element
            const messageElement = document.createElement('div');
            messageElement.classList.add('chat-message');
            
            const messageContent = document.createElement('div');
            messageContent.classList.add('message-content');
            
            const messageText = document.createElement('p');
            messageText.innerHTML = `<strong>${message.user}</strong>: ${message.text}`;
            
            if (message.imageUrl) {
                const imageElement = document.createElement('img');
                imageElement.src = message.imageUrl;
                messageContent.appendChild(messageText);
                messageContent.appendChild(imageElement);
            } else {
                messageContent.appendChild(messageText);
            }
            
            const timestampElement = document.createElement('div');
            timestampElement.classList.add('message-timestamp');
            timestampElement.textContent = time;
            
            messageElement.appendChild(messageContent);
            messageElement.appendChild(timestampElement);
            
            chatMessages.appendChild(messageElement);
        });

        // Scroll to the bottom to show the latest messages
        chatMessages.scrollTop = chatMessages.scrollHeight;
    });
}



chatForm.addEventListener('submit', function(event) {
    event.preventDefault();
    const message = messageInput.value;
    sendMessage(message).then(() => {
        messageInput.value = '';
    }).catch(error => {
        console.error('Error sending message:', error);
    });
});

loadMessages();

// Image upload functionality
uploadButton.addEventListener('click', function() {
    const file = fileInput.files[0];
    if (file) {
        const fileRef = ref(storage, 'images/' + file.name);
        uploadBytes(fileRef, file).then(snapshot => {
            console.log('Uploaded a file!');
            return getDownloadURL(fileRef);
        }).then(url => {
            return sendMessage('', url);
        }).then(() => {
            console.log('Image metadata saved and sent as message!');
        }).catch(error => {
            console.error('Upload or metadata save failed:', error);
        });
    }
});

</script>
<footer>
    <p>&copy; 2024 Parth Santosh Katyare</p>
</footer></body></html>